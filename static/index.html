<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smart Scheduler</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0 auto; max-width: 800px; padding: 20px; background-color: #f9fafb; }
        .container { background-color: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1, h2 { color: #111827; }
        label { display: block; margin-top: 15px; font-weight: 600; color: #374151; }
        textarea, input[type="text"] { width: 98%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 1rem; margin-top: 5px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-top: 20px; }
        .btn-secondary { background-color: #e5e7eb; color: #1f2937; }
        .btn-primary { background-color: #2563eb; color: white; font-weight: 600; }
        #link-output { margin-top: 20px; font-size: 1.1rem; }
        #translated-output { background-color: #f3f4f6; border: none; }
        hr { border: none; border-top: 1px solid #e5e7eb; margin: 25px 0; }
        .loading { display: none; text-align: center; font-size: 1.2rem; color: #374151; }
    </style>
</head>
<body>

    <div class="container">
        <h1>AI Smart Schedule Extractor ğŸ¤–</h1>
        <p>Supports both Korean (auto-translate) and English inputs.</p>

        <h2>Step 1: Input & Translate (ì…ë ¥ ë° ë²ˆì—­)</h2>
        <label for="input-text">ğŸ“ Input Text (Korean or English)</label>
        <textarea id="input-text" rows="5" placeholder="ì˜ˆ: 'ë‚´ì¼ ì˜¤í›„ 2ì‹œì— ê°•ë‚¨ì—­ì—ì„œ íšŒì˜í•˜ì'"></textarea>

        <button id="extract-button" class="btn-secondary" onclick="handleExtract()">1. Translate & Extract</button>

        <label for="translated-output">Result (Translated to English)</label>
        <textarea id="translated-output" rows="2" readonly></textarea>

        <hr>

        <h2>âœï¸ Step 2: Review, Edit, and Generate Link</h2>

        <label for="date-box">ğŸ“… Date (Edit here)</label>
        <input type="text" id="date-box">

        <label for="time-box">â° Time (Edit here)</label>
        <input type="text" id="time-box">

        <label for="loc-box">ğŸ“ Location (Edit here)</label>
        <input type="text" id="loc-box">

        <label for="event-box">ğŸ‰ Event (Edit here)</label>
        <input type="text" id="event-box">

        <button id="generate-button" class="btn-primary" onclick="handleGenerateLink()">2. Generate Calendar Link</button>

        <div class="loading" id="loading-spinner">ğŸ”„ Generating Link...</div>
        <div id="link-output"></div>
    </div>

    <script>
        // ì´ ë³€ìˆ˜ë“¤ì€ 1ë‹¨ê³„ê°€ ëë‚˜ê³  ì±„ì›Œì§‘ë‹ˆë‹¤.
        // These variables will be filled after Step 1.
        let originalText = "";
        let translatedText = "";

        // 1. "Translate & Extract" ë²„íŠ¼ í´ë¦­ ì‹œ
        // 1. When "Translate & Extract" button is clicked
        async function handleExtract() {
            const inputText = document.getElementById('input-text').value;
            const extractButton = document.getElementById('extract-button');
            extractButton.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™” / Disable button
            extractButton.innerText = "ğŸ”„ Processing...";

            try {
                // FastAPIì˜ /extract ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
                // Call FastAPI's /extract endpoint
                const response = await fetch('/extract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: inputText })
                });

                if (!response.ok) {
                    throw new Error('Server error');
                }

                const data = await response.json(); // JSON ì‘ë‹µ ë°›ê¸° / Get JSON response

                // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (2ë‹¨ê³„ì—ì„œ ì‚¬ìš©)
                // Save to global variables (for use in Step 2)
                originalText = data.original_text;
                translatedText = data.translated_text;

                // UIì˜ í…ìŠ¤íŠ¸ ìƒì ì±„ìš°ê¸°
                // Fill in the UI text boxes
                document.getElementById('translated-output').value = data.translated_text;
                document.getElementById('date-box').value = data.date;
                document.getElementById('time-box').value = data.time;
                document.getElementById('loc-box').value = data.loc;
                document.getElementById('event-box').value = data.event;

            } catch (error) {
                console.error('Error during extraction:', error);
                alert('An error occurred. Please check the console.');
            } finally {
                extractButton.disabled = false; // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™” / Re-enable button
                extractButton.innerText = "1. Translate & Extract";
            }
        }

        // 2. "Generate Calendar Link" ë²„íŠ¼ í´ë¦­ ì‹œ
        // 2. When "Generate Calendar Link" button is clicked
        async function handleGenerateLink() {
            const generateButton = document.getElementById('generate-button');
            const loadingSpinner = document.getElementById('loading-spinner');
            const linkOutput = document.getElementById('link-output');

            generateButton.disabled = true;
            loadingSpinner.style.display = 'block'; // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ / Show loading spinner
            linkOutput.innerHTML = '';

            try {
                // ì‚¬ìš©ìê°€ ìˆ˜ì •í•œ ê°’ë“¤ì„ ê°€ì ¸ì˜´
                // Get the user-edited values
                const linkRequest = {
                    date_str: document.getElementById('date-box').value,
                    time_str: document.getElementById('time-box').value,
                    loc_str: document.getElementById('loc-box').value,
                    event_str: document.getElementById('event-box').value,
                    original_text: originalText,     // 1ë‹¨ê³„ì—ì„œ ì €ì¥í•œ ê°’
                    translated_text: translatedText  // 1ë‹¨ê³„ì—ì„œ ì €ì¥í•œ ê°’
                };

                // FastAPIì˜ /generate-link ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
                // Call FastAPI's /generate-link endpoint
                const response = await fetch('/generate-link', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(linkRequest)
                });

                if (!response.ok) {
                    throw new Error('Server error');
                }

                const data = await response.json();

                if (data.google_calendar_url) {
                    // ì„±ê³µ: í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ ìƒì„±
                    // Success: Create a clickable link
                    linkOutput.innerHTML = `âœ… <a href="${data.google_calendar_url}" target="_blank"><b>Click here to add to your Google Calendar</b></a>`;
                } else {
                    throw new Error('Link generation failed.');
                }

            } catch (error) {
                console.error('Error generating link:', error);
                linkOutput.innerHTML = 'âŒ (Link generation failed. Check date/time format.)';
            } finally {
                generateButton.disabled = false;
                loadingSpinner.style.display = 'none'; // ë¡œë”© ìŠ¤í”¼ë„ˆ ìˆ¨ê¹€ / Hide loading spinner
            }
        }
    </script>

</body>
</html>