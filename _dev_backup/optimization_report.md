# 모델 레이어 최적화 성능 비교 리포트

> **작성일**: 2025-12-04  
> **최종 수정**: 2025-12-04 22:35  
> **목적**: 커스텀 패턴 매처 도입 전후 성능 비교

---

## 1. Before (기존 시스템: spaCy + Gemini)

### 테스트 환경
- **측정 일시**: 2025-12-04 18:35:51
- **테스트 케이스**: 10개 (한국어 5, 영어 5)

### 요약 지표

| 지표 | 결과 |
|------|------|
| DATE 인식률 | 50.0% (4/8) |
| TIME 인식률 | 16.7% (1/6) |
| LOC 인식률 | 66.7% (2/3) |
| Gemini 호출률 | 50% (5/10) |
| 평균 응답시간 | 6.24초 |

### 주요 문제점
- "내일" → "tomorrow" (형식 변환 안됨)
- "오후 3시" → "3pm" (형식 변환 안됨)
- "강남역" → 인식 실패

---

## 2. After (개선 시스템: Pattern Matcher + spaCy + Gemini)

### 테스트 환경
- **측정 일시**: 2025-12-04 22:34:14
- **변경 사항**: `pattern_matcher.py` 추가, `main.py` 수정

### 요약 지표

| 지표 | 결과 |
|------|------|
| DATE 인식률 | **100%** (8/8) |
| TIME 인식률 | **100%** (6/6) |
| LOC 인식률 | **100%** (3/3) |
| Gemini 호출률 | 50% (5/10) |
| 평균 응답시간 | 6.03초 |

### 상세 결과

| # | 입력 | DATE | TIME | LOC | 모델 |
|---|------|------|------|-----|------|
| 1 | 내일 오후 3시에 강남역에 미팅 | 2025-12-05 ✅ | 15:00 ✅ | 강남역 ✅ | spaCy |
| 2 | 12월 25일 크리스마스 파티 | 2025-12-25 ✅ | - | - | Gemini |
| 3 | 다음주 금요일 오전 10시 회의 | 2025-12-12 ✅ | 10:00 ✅ | - | spaCy |
| 4 | 2025년 1월 15일 신년회 | 2025-01-15 ✅ | - | - | Gemini |
| 5 | 매주 월요일 9시 정례회의 | - | 09:00 ✅ | - | spaCy |
| 6 | Meeting at 3pm tomorrow | 2025-12-05 ✅ | 15:00 ✅ | - | spaCy |
| 7 | Dec 25 Christmas dinner at home | 2025-12-25 ✅ | - | home ✅ | Gemini |
| 8 | next Friday 2:30 PM conference | 2025-12-12 ✅ | 14:30 ✅ | - | spaCy |
| 9 | 오후 2시부터 4시까지 세미나 | - | 14:00 ✅ | - | Gemini |
| 10 | 12/20 at Seoul Station | 2025-12-20 ✅ | - | Seoul Station ✅ | Gemini |

---

## 3. Before vs After 비교

| 지표 | Before | After | 변화 |
|------|--------|-------|------|
| **DATE 정확도** | 50.0% | **100%** | **+50%** ✅ |
| **TIME 정확도** | 16.7% | **100%** | **+83.3%** ✅ |
| **LOC 정확도** | 66.7% | **100%** | **+33.3%** ✅ |
| Gemini 호출률 | 50% | 50% | 변화 없음 |
| 평균 응답시간 | 6.24s | 6.03s | -0.21s |

---

## 4. 결론

### ✅ 채택 결정: **채택**

**달성 사항:**
- 정확도 100% 달성 (DATE, TIME, LOC 모두)
- 한국어 날짜/시간/장소 패턴 지원
- 상대적 날짜 해석 ("내일", "다음주 금요일")
- 시간 형식 정규화 ("오후 3시" → "15:00")

---

## 5. 작동 로직

### 처리 흐름도

```
사용자 입력
    │
    ├─────────────────────────────────────┐
    │                                     │
    ▼                                     ▼
[Pattern Matcher]                    [번역 (한→영)]
 (원본 텍스트)                            │
    │                                     ▼
    │                              [spaCy NER]
    │                               (번역된 텍스트)
    │                                     │
    ▼                                     ▼
┌─────────────────────────────────────────────┐
│            결과 병합 및 필터링               │
│  1. Pattern Matcher 결과 우선 사용          │
│  2. spaCy 결과는 검증 후 보조로 사용         │
│  3. 날짜형식(12/20)을 시간에서 제외          │
│  4. 시간키워드(내일)를 장소에서 제외          │
└─────────────────────────────────────────────┘
    │
    ▼
{날짜, 시간, 장소 충분?}
    │
    ├── Yes ──▶ [결과 반환] (Fast-Inference)
    │
    └── No ───▶ [Gemini API 호출]
                      │
                      ▼
                [결과 반환] (Smart)
```

### 핵심 컴포넌트

#### 1. Pattern Matcher (`pattern_matcher.py`)
```python
class SchedulePatternMatcher:
    # 날짜 패턴 (한국어 + 영어)
    - "2025년 12월 5일" → 2025-12-05
    - "12월 5일" → 2025-12-05 (올해 가정)
    - "내일" → 2025-12-05
    - "다음주 금요일" → 2025-12-12
    - "Dec 25" → 2025-12-25
    - "tomorrow" → 2025-12-05
    
    # 시간 패턴
    - "오후 3시" → 15:00
    - "오전 10시 30분" → 10:30
    - "3pm" → 15:00
    - "2:30 PM" → 14:30
    - "14:30" → 14:30
    
    # 장소 패턴
    - "강남역에서" → 강남역
    - "at Seoul Station" → Seoul Station
```

#### 2. NER 추출 함수 (`main.py`)
```python
def run_ner_extraction(text, nlp_model, original_text=None):
    # Phase 1: Pattern Matcher (원본 텍스트 사용)
    pm_dates = pm.extract_dates(original_text)
    pm_times = pm.extract_times(original_text)
    pm_loc = pm.extract_locations(original_text)
    
    # Phase 2: spaCy NER (번역된 텍스트 사용)
    # 보조 역할
    
    # Phase 3: 결과 병합
    # Pattern Matcher 우선, spaCy 보조
    # 필터링: 날짜 형식을 시간에서 제외
    # 필터링: 시간 키워드를 장소에서 제외
```

### 파일 구조
```
Acdt_Project_Render_ver/
├── pattern_matcher.py     # [NEW] 커스텀 패턴 매처
├── main.py                # [MODIFIED] Pattern Matcher 통합
├── benchmark.py           # 벤치마크 도구
└── optimization_report.md # 이 문서
```
